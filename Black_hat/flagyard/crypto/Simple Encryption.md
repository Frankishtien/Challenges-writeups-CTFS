# Simple Encryption

**``output.txt``**


```
[2, 73, 1279408694547274513244, 70105353946758363501802138205221132116, 272148444178645238255514677550260999012, 163070467820033153100988222221846406804, 86609496736369644722288034975639055628, 43128937165519816694258357152848494692, 320502000447316005409150167725211662724, 230178489086985152360072978627746714136, 51150919076204957128326106222833577076, 158240773363986558037607386784088940512, 304872496244635022312927683343945975156, 202848589728975784044527562137406231080, 7512389313575766780334514817734366976, 317213214347465770134647167616737395936, 151312341367906897735996944848577837928, 64442256831805280603281150422551063112, 46403079410007868840393933283231595664, 242473477743480427014125328686736940864, 53751688610473184360488785914556597624, 264175654134934177270269532228856344808, 59416574383127958958001760358914739208, 173626441680373497762981141808784854752, 96381203943555361752613580177449489792, 329162363675487685462360844964413481096, 193847948954369472983440009588539888552, 14450814094760923686146700048910753880, 198292150880585425958299965612615727776, 66786252247714141354755736365166242592, 78855848200194772380486016889274412456, 287550771686395960666144215762384325544, 297285574293655676309991420245534301208, 202501546131305814880557502943201564456, 151580341865118112418086843707020081216, 286941584051816509936971192867320835768, 303190756018448920035596127661477151272, 269171740993929521407477704933540132840, 184061349173849002083098988591970870992, 11968324907838152482831596404855563944, 307775715382277269039606144448918323720, 261495359018140595179051874736240188656, 88722822967841822844499727199659872248, 219857135538301014962603568439151933128, 190092548323415860089998932753848376480, 38870081668500098969220100832857729560, 87609724375251563632564845142147403848]
```


**``chal.py``**

```python
from secrets import randbelow

M = 2**128

def enc(msg, key):
    o = [2, 73]
    for i, p in enumerate(map(ord, msg)):
        o.append(((key*o[i+1])^(key+(o[i]*p))) % M)
    return o

key = randbelow(2**64)
flag = open('flag.txt', 'r').read().strip()
ct = enc(flag, key)
print(ct)
```


----

> ## **``solution``**

```python
# decrypt_ct.py
ct = [2, 73, 1279408694547274513244, 70105353946758363501802138205221132116,
272148444178645238255514677550260999012, 163070467820033153100988222221846406804,
86609496736369644722288034975639055628, 43128937165519816694258357152848494692,
320502000447316005409150167725211662724, 230178489086985152360072978627746714136,
51150919076204957128326106222833577076, 158240773363986558037607386784088940512,
304872496244635022312927683343945975156, 202848589728975784044527562137406231080,
7512389313575766780334514817734366976, 317213214347465770134647167616737395936,
151312341367906897735996944848577837928, 64442256831805280603281150422551063112,
46403079410007868840393933283231595664, 242473477743480427014125328686736940864,
53751688610473184360488785914556597624, 264175654134934177270269532228856344808,
59416574383127958958001760358914739208, 173626441680373497762981141808784854752,
96381203943555361752613580177449489792, 329162363675487685462360844964413481096,
193847948954369472983440009588539888552, 14450814094760923686146700048910753880,
198292150880585425958299965612615727776, 66786252247714141354755736365166242592,
78855848200194772380486016889274412456, 287550771686395960666144215762384325544,
297285574293655676309991420245534301208, 202501546131305814880557502943201564456,
151580341865118112418086843707020081216, 286941584051816509936971192867320835768,
303190756018448920035596127661477151272, 269171740993929521407477704933540132840,
184061349173849002083098988591970870992, 11968324907838152482831596404855563944,
307775715382277269039606144448918323720, 261495359018140595179051874736240188656,
88722822967841822844499727199659872248, 219857135538301014962603568439151933128,
190092548323415860089998932753848376480, 38870081668500098969220100832857729560,
87609724375251563632564845142147403848]

M = 1 << 128
r = ct
flag_len = len(r) - 2

# Reconstruct key bit-by-bit (0..63)
def possible_for_mask(k_try, mask):
    for i in range(flag_len):
        left = (r[i+2] ^ ((k_try * r[i+1]) & mask)) & mask
        target = (left - k_try) & mask
        ri = r[i]
        ok = False
        for p in range(256):
            if (ri * p) & mask == target:
                ok = True
                break
        if not ok:
            return False
    return True

k_mod = 0
for b in range(64):
    mask = (1 << (b+1)) - 1
    # prefer 0 if both possible (arbitrary tie-break)
    if possible_for_mask(k_mod, mask) and not possible_for_mask(k_mod | (1<<b), mask):
        pass
    elif possible_for_mask(k_mod | (1<<b), mask):
        k_mod |= (1<<b)
    else:
        raise Exception("No solution at bit %d" % b)

k = k_mod
print("Recovered key (dec):", k)
print("Recovered key (hex):", hex(k))

# Recover plaintext bytes
plain = []
for i in range(flag_len):
    temp = (r[i+2] ^ ((k * r[i+1]) % M)) - k
    temp %= M
    ri = r[i]
    found = None
    for p in range(256):
        if (ri * p) % M == temp:
            found = p
            break
    if found is None:
        raise Exception("No p found at index %d" % i)
    plain.append(found)

flag = ''.join(chr(x) for x in plain)
print("Flag:", flag)

```


**``result``**

```
Recovered key (dec): 17608713827523745640
Recovered key (hex): 0xf45eb7ee610fd768
Flag: FlagY{e4sy_3nc_3asy_d3c_a6cebdf01bf8a8feb61f}

```






